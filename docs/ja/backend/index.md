# バックエンドドキュメント

MineAdmin 3.x バックエンド開発ドキュメントへようこそ。このドキュメントでは、MineAdminのバックエンドアーキテクチャ、開発規範、ベストプラクティスを深く理解するための手助けをします。

## アーキテクチャ概要

MineAdminバックエンドはモダンなPHP技術スタックで構築されており、Hyperf 3.xフレームワークをベースに、高性能なコルーチン環境で動作します。

### コア特性

- **高性能コルーチン**: Swoole/Swow拡張のコルーチン特性を活用した優れた並列処理性能
- **モダンなアーキテクチャ**: 明確なレイヤードアーキテクチャ
- **安全で信頼性高**: ダブルトークン認証メカニズムを内蔵、完全な権限制御システム
- **拡張容易**: プラグイン開発をサポート、モジュール化設計

## 技術スタック

| 技術コンポーネント | バージョン | 説明 |
|---------|------|------|
| PHP | 8.x+ | モダンなPHP言語特性サポート |
| Hyperf | 3.x | 高性能コルーチンフレームワーク |
| Swoole/Swow | 最新安定版 | コルーチンランタイム環境 |
| MySQL | 5.7+ / 8.0+ | メインデータベース |
| Redis | 6.0+ | キャッシュとセッションストレージ |
| JWT | - | lcobucci/jwtベースの認証ソリューション |

## クイックスタート

### 環境要件

- PHP >= 8.1
- Swoole >= 5.1 または Swow >= 1.0
- MySQL
- Redis

### サービス起動

```bash
# HTTPサービス起動
php bin/hyperf.php start
```

### 開発モード

```bash
# ホットリロードモード（開発環境推奨）
php bin/hyperf.php server:watch
```

## プロジェクト構造

MineAdminのディレクトリ構造はLaravelの設計理念を参考にしており、Laravel開発経験があればすぐに習得できます。

### ルートディレクトリ構造

```
├── App/              # アプリケーションコアコードディレクトリ
├── Config/           # 設定ファイルディレクトリ
├── Database/         # データベース関連ファイル
├── Storage/          # ストレージディレクトリ（ログ、アップロードファイル等）
├── Tests/            # テストコードディレクトリ
├── Web/              # フロントエンドアプリケーションコード
└── Plugin/           # プラグインディレクトリ
```

### Appディレクトリ詳細

```
App/
├── Exceptions/       # 例外処理
├── Http/            # HTTP関連（コントローラ、ミドルウェア、リクエスト検証）
├── Model/           # データモデル（Eloquent ORM）
├── Service/         # ビジネスロジック層
├── Repository/      # データアクセス層
└── Schema/          # APIドキュメントスキーマ定義
```

**アーキテクチャレイヤー説明**:

- **Controller**: HTTPリクエスト処理、パラメータ検証とレスポンスフォーマット
- **Service**: ビジネスロジック調整、RepositoryとModelの調整
- **Repository**: データアクセス抽象化、統一データソース（MySQL、Redis、ES等）
- **Model**: データモデル定義、コルーチン版Eloquent ORMベース

## コア機能

### 認証・認可

- **ダブルトークンメカニズム**: Access Token + Refresh Tokenによるシームレスなリフレッシュ
- **RBAC権限制御**: ロールベースのアクセス制御、データ権限サポート
- **マルチクライアントサポート**: Web、モバイル、APIなど多様なクライアント対応

### データ権限

- **柔軟な設定**: ルールベースのデータ権限制御
- **多次元サポート**: 部門、ユーザー、ロールなど多次元の権限制御
- **透過的統合**: ビジネスロジックに影響を与えない統合

### ログ監視

- **操作ログ**: ユーザー操作行動の詳細記録
- **ログインログ**: ユーザーログイン記録とセキュリティ分析
- **システムログ**: アプリケーション実行ログとエラートラッキング

## 開発ガイド

### 基本開発

- [ディレクトリ構造詳細](./base/structure.md) - プロジェクトディレクトリ構成の詳細理解
- [ライフサイクル](./base/lifecycle.md) - アプリケーション起動とリクエスト処理フロー
- [ルーティングシステム](./base/router.md) - ルート定義とミドルウェア使用
- [例外処理](./base/error-handler.md) - 統一例外処理メカニズム

### 高度な機能

- [セキュリティメカニズム](./security/passport.md) - 認証と認可の詳細
- [データ権限](./data-permission/overview.md) - データ権限システムの使用
- [イベント処理](./base/event-handler.md) - イベント駆動開発

### デプロイ・運用

- [ログ管理](./base/logger.md) - ログ設定と管理
- [ファイルアップロード](./base/upload.md) - ファイル処理とストレージ

## プラグイン開発

MineAdminはプラグイン拡張をサポートしており、プラグインメカニズムでシステム機能を迅速に拡張できます:

- [プラグイン開発ガイド](../plugin/index.md) - プラグイン開発完全チュートリアル
- [アプリケーションマーケット](../plugin/develop/publish.md) - プラグイン公開と配布

## APIドキュメント

- [APIインターフェースドキュメント](../api/) - 完全なREST APIドキュメント
- SwaggerドキュメントURL: `/swagger` （開発環境）

## よくある質問

- [FAQ よくある質問](../faq/) - 開発中のよくある問題と解決策

## コミュニティとサポート

- **GitHub**: [https://github.com/mineadmin/mineadmin](https://github.com/mineadmin/mineadmin)
- **ドキュメント問題**: [Issueを提出](https://github.com/mineadmin/doc-v3/issues)
- **技術交流**: 公式コミュニティグループに参加

## 参考資料

このドキュメント作成では以下の優れたプロジェクトのドキュメントを参考にしました（順不同）:

1. [Laravel 公式ドキュメント](https://laravel.com/docs/11.x/)
2. [Hyperf 公式ドキュメント](https://hyperf.wiki/3.1)

---

**次に**: プロジェクトアーキテクチャを深く理解するために、まず[ディレクトリ構造詳細](./base/structure.md)を読むことをお勧めします。
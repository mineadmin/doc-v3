# ルーティングとメニュー

`2.x`と同様に、システムは`vue-router`に基づいて基本的なルーティングシステムを提供しており、**静的ルーティング**と**動的ルーティング**に分かれています。

## ルーティング、メニュー説明

### 静的ルーティング
静的ルーティングはフロントエンドで事前に定義され、起動時に既に確定されているルーティングです。
ページに権限制御が必要ない場合、直接静的ルーティングを使用できます。システム内のすべての静的ルーティング設定は`src/router/static-routes`ディレクトリにあります。
システムによって読み込まれ、動的ルーティングと統合されて最終的なルーティングデータとなります。

::: tip 将来の構想
実際には、**ファイルがルーティング**となる`ファイルルーティング`モードにすることも可能でした。しかし、現在`MineAdmin`内に適切なシナリオが見つかっていません。
おそらく将来的にはファイルルーティングシステムが追加されるかもしれません。
:::

### 動的ルーティング
動的ルーティングは、ユーザーがログインした後、`/admin/permission/menus`インターフェースをリクエストし、サーバーから返されたメニュー権限データに基づいて動的に生成されるルーティングです。
このステップでは、システムがサーバーから返されたデータをフロントエンドが認識できるルーティングに変換し、さらに表示可能なメニューに変換する必要があります。

### メニュー

メニューはルーティングの別の表現形式です。静的ルーティングであろうと動的ルーティングであろうと、最終的にはルーティングがメニューに変換され、インターフェース上に表示されます。これらは密接に関連しています。

## ルーティング設定

### 基本設定
まず、`#/types/global.d.ts`内でルーティングのデータ型`MineRouter`を定義しています。定義は以下の通りです：
::: details データ型定義を表示
```ts
declare namespace MineRoute {
  interface routeRecord {
    name?: string
    path?: string
    redirect?: string
    expand?: boolean
    component?: () => Promise<any>
    components?: () => Promise<any>
    meta?: RouteMeta
    children?: routeRecord[]
  }
  interface RouteMeta {
    title?: string | (() => string)
    i18n?: string | (() => string)
    badge?: () => string | number
    icon?: string
    affix?: boolean
    hidden?: boolean
    subForceShow?: boolean
    copyright?: boolean
    link?: string
    breadcrumb?: routeRecord[]
    breadcrumbEnable?: boolean
    activeName?: string
    cache?: boolean
    type?: 'M' | 'B' | 'I' | 'L' | string
    // 権限検証設定
    auth?: string[]
    role?: string[]
    user?: string[]
  }
}
```
:::

ルーティングの重要な設定は`meta`のメタデータで定義されています。上記のデータ型構造をクリックして確認できます。以下は設定例です：

```ts {6-10}
const routes = [
  {
    name: 'welcome',
    path: '/welcome',
    component: () => import('~/base/views/welcome/index.vue'),
    meta: {
      icon: 'icon-park-outline:jewelry',
      title: 'ようこそ',
      i18n: 'menu.welcome',
    },
  },
];
```

### META 項目説明

#### title

- タイプ：`string`
- デフォルト値：`''`

ルーティングのタイトルを設定します。メニューやタブ、ブラウザのタイトルなど、さまざまな場面で表示されます。`i18n`項目が設定されていない場合、デフォルトで表示されるタイトルになります。

#### icon

- タイプ：`string`
- デフォルト値：`''`

ルーティングのアイコンを設定します。メニュー、パンくずリスト、タブなどで表示されます。通常、アイコンライブラリと組み合わせて使用されます。

#### type

- タイプ：`'M' | 'B' | 'I' | 'L'`
- デフォルト値：`''`

ルーティングのタイプを設定します。`M：メニュー、B：ボタン、I：iFrame、L：外部リンク`。ルーティングでは、`B`タイプのルーティングはメニューに表示されず、下位ルーティングを持つことはできません。
`I`と`L`タイプは2階層以上のルーティングを持つことができず、`M`タイプのみが他のすべてのタイプのルーティングを持つことができます。

#### badge

- タイプ：`string`
- デフォルト値：`''`

ルーティングのバッジを設定します。メニューの後ろに赤い背景のバッジが表示され、メニューの特殊性をマークします。

#### affix

- タイプ：`boolean`
- デフォルト値：`false`

ページをデフォルトでタブに固定するかどうかを設定します。

#### cache

- タイプ：`boolean`
- デフォルト値：`false`

ページをキャッシュするかどうかを設定します。この項目を有効にする場合、ページ内で以下を定義する必要があります：

`defineOptions({ name: 'メニューのname' })`

#### hidden

- タイプ：`boolean`
- デフォルト値：`false`

ルーティングをメニューに表示するかどうかを設定します。表示されなくても、このルーティングは登録されており、アドレスを入力してアクセスできます。

#### subForceShow

- タイプ：`boolean`
- デフォルト値：`false`

ルーティングを子サイドバーに強制的に表示するかどうかを設定します。`hidden`と競合しません。

#### copyright

- タイプ：`boolean`
- デフォルト値：`false`

ページの下部に著作権情報を表示するかどうかを設定します。

#### link

- タイプ：`string`
- デフォルト値：`''`

外部リンクおよびiFrameタイプのメニューリンクを設定します。このプロパティは`type === 'I' | 'L'`の場合にのみ有効です。

#### breadcrumb

- タイプ：`routeRecord[]`
- デフォルト値：`[]`

このプロパティは無視できます。システム内部で自動的に処理されます。

#### breadcrumbEnable

- タイプ：`boolean`
- デフォルト値：`false`

ルーティングをパンくずリストに表示するかどうかを設定します。

#### activeName

- タイプ：`string`
- デフォルト値：`''`

ルーティングがアクティブになった際に、どのメニューをハイライト表示するかを設定します。

#### auth

- タイプ：`string[]`
- デフォルト値：`[]`

どの権限でルーティングにアクセスできるかを設定します。

#### role

- タイプ：`string[]`
- デフォルト値：`[]`

どのロールでルーティングにアクセスできるかを設定します。

#### user

- タイプ：`string[]`
- デフォルト値：`[]`

どのユーザーでルーティングにアクセスできるかを設定します。
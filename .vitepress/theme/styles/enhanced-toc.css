/**
 * Enhanced Table of Contents (TOC) for VitePress
 * Modern, interactive aside navigation with advanced features
 * Optimized for multilingual content and long documentation
 */

/* ========================================================================
   1. CSS Variables & Theme Configuration
   ======================================================================== */

:root {
    /* TOC Color Palette */
    --toc-gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --toc-gradient-active: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    --toc-gradient-hover: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);

    /* Depth Indicators */
    --toc-indent-base: 1rem;
    --toc-indent-multiplier: 0.75;

    /* Typography Scale */
    --toc-font-h1: 0.95rem;
    --toc-font-h2: 0.9rem;
    --toc-font-h3: 0.85rem;
    --toc-font-h4: 0.825rem;
    --toc-font-h5: 0.8rem;
    --toc-font-h6: 0.775rem;

    /* Spacing */
    --toc-item-padding: 0.5rem 0.75rem;
    --toc-item-margin: 0.125rem 0;

    /* Animations */
    --toc-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --toc-spring: cubic-bezier(0.68, -0.55, 0.265, 1.55);

    /* Shadows & Effects */
    --toc-shadow-subtle: 0 2px 8px rgba(0, 0, 0, 0.04);
    --toc-shadow-hover: 0 4px 12px rgba(91, 103, 234, 0.15);
    --toc-shadow-active: 0 6px 20px rgba(91, 103, 234, 0.25);

    /* Progress Bar */
    --toc-progress-height: 3px;
    --toc-progress-color: var(--toc-gradient-primary);
}

/* Dark Theme Adjustments */
.dark {
    --toc-shadow-subtle: 0 2px 8px rgba(0, 0, 0, 0.2);
    --toc-shadow-hover: 0 4px 12px rgba(159, 122, 234, 0.25);
    --toc-shadow-active: 0 6px 20px rgba(159, 122, 234, 0.35);
}

/* ========================================================================
   2. Container & Layout Enhancements
   ======================================================================== */

/* Main TOC Container */
.VPDocAsideOutline {
    position: sticky;
    top: calc(var(--vp-nav-height) + 2rem);
    max-height: calc(100vh - var(--vp-nav-height) - 4rem);
    overflow-y: auto;
    overflow-x: hidden;
    padding: 1.5rem;
    background: var(--vp-c-bg-soft);
    border-radius: 16px;
    border: 1px solid var(--vp-c-divider);
    box-shadow: var(--toc-shadow-subtle);
    transition: var(--toc-transition);
}

/* Custom Scrollbar */
.VPDocAsideOutline::-webkit-scrollbar {
    width: 6px;
}

.VPDocAsideOutline::-webkit-scrollbar-track {
    background: transparent;
    border-radius: 3px;
}

.VPDocAsideOutline::-webkit-scrollbar-thumb {
    background: var(--vp-c-divider);
    border-radius: 3px;
    transition: background 0.2s;
}

.VPDocAsideOutline::-webkit-scrollbar-thumb:hover {
    background: var(--vp-c-brand-1);
}

/* TOC Header with Reading Progress */
.VPDocAsideOutline::before {
    content: 'On this page';
    display: block;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--vp-c-text-3);
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid var(--vp-c-divider);
    position: relative;
}

/* Localized Headers */
:lang(zh) .VPDocAsideOutline::before { content: '本页目录'; }
:lang(ja) .VPDocAsideOutline::before { content: 'このページ'; }
:lang(zh-hk) .VPDocAsideOutline::before,
:lang(zh-tw) .VPDocAsideOutline::before { content: '本頁目錄'; }

/* Reading Progress Bar */
.VPDocAsideOutline::after {
    content: '';
    position: absolute;
    top: 3.25rem;
    left: 1.5rem;
    right: 1.5rem;
    height: var(--toc-progress-height);
    background: var(--vp-c-divider-light);
    border-radius: 1.5px;
    z-index: 0;
}

/* Progress Indicator (JavaScript will update width) */
.VPDocAsideOutline[data-progress]::after {
    background: linear-gradient(
            90deg,
            var(--vp-c-divider-light) 0%,
            var(--vp-c-divider-light) var(--toc-progress, 0%),
            transparent var(--toc-progress, 0%)
    );
}

/* ========================================================================
   3. Navigation Items & Hierarchy
   ======================================================================== */

/* Content Container */
.VPDocAsideOutline .content {
    position: relative;
    padding-top: 0.5rem;
}

/* Outline Container */
.VPDocAsideOutline .outline-marker {
    position: absolute;
    left: 0;
    width: 3px;
    background: var(--toc-gradient-active);
    border-radius: 0 2px 2px 0;
    transition: var(--toc-transition);
    opacity: 0;
    transform: translateY(0);
}

.VPDocAsideOutline .outline-marker.active {
    opacity: 1;
}

/* Links Container */
.VPDocAsideOutline .outline-link {
    display: block;
    position: relative;
    padding: var(--toc-item-padding);
    margin: var(--toc-item-margin);
    color: var(--vp-c-text-2);
    text-decoration: none;
    border-radius: 8px;
    transition: var(--toc-transition);
    font-size: var(--toc-font-h2);
    line-height: 1.5;
    overflow: hidden;
}

/* Depth-based Styling */
.VPDocAsideOutline .outline-link[data-level="1"] {
    font-size: var(--toc-font-h1);
    font-weight: 600;
    color: var(--vp-c-text-1);
    margin-top: 0.75rem;
    background: var(--vp-c-bg-alt);
    border-left: 3px solid var(--vp-c-brand-1);
}

.VPDocAsideOutline .outline-link[data-level="2"] {
    padding-left: calc(var(--toc-indent-base) * 1);
    font-size: var(--toc-font-h2);
    font-weight: 500;
}

.VPDocAsideOutline .outline-link[data-level="3"] {
    padding-left: calc(var(--toc-indent-base) * 1.75);
    font-size: var(--toc-font-h3);
}

.VPDocAsideOutline .outline-link[data-level="4"] {
    padding-left: calc(var(--toc-indent-base) * 2.5);
    font-size: var(--toc-font-h4);
    opacity: 0.9;
}

.VPDocAsideOutline .outline-link[data-level="5"] {
    padding-left: calc(var(--toc-indent-base) * 3.25);
    font-size: var(--toc-font-h5);
    opacity: 0.85;
}

.VPDocAsideOutline .outline-link[data-level="6"] {
    padding-left: calc(var(--toc-indent-base) * 4);
    font-size: var(--toc-font-h6);
    opacity: 0.8;
}

/* Visual Hierarchy Indicators */
.VPDocAsideOutline .outline-link::before {
    content: '';
    position: absolute;
    left: 0.5rem;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 4px;
    background: var(--vp-c-text-3);
    border-radius: 50%;
    opacity: 0;
    transition: var(--toc-transition);
}

.VPDocAsideOutline .outline-link[data-level="2"]::before,
.VPDocAsideOutline .outline-link[data-level="3"]::before {
    opacity: 0.4;
}

.VPDocAsideOutline .outline-link[data-level="4"]::before,
.VPDocAsideOutline .outline-link[data-level="5"]::before,
.VPDocAsideOutline .outline-link[data-level="6"]::before {
    opacity: 0.3;
    width: 3px;
    height: 3px;
}

/* ========================================================================
   4. Interactive States & Animations
   ======================================================================== */

/* Hover State */
.VPDocAsideOutline .outline-link:hover {
    color: var(--vp-c-brand-1);
    background: var(--vp-c-brand-soft);
    transform: translateX(4px);
    box-shadow: var(--toc-shadow-hover);
}

.VPDocAsideOutline .outline-link:hover::before {
    opacity: 1;
    background: var(--vp-c-brand-1);
    width: 6px;
    height: 6px;
}

/* Active/Current State */
.VPDocAsideOutline .outline-link.active {
    color: var(--vp-c-brand-1);
    font-weight: 600;
    background: linear-gradient(
            90deg,
            var(--vp-c-brand-soft) 0%,
            transparent 100%
    );
    box-shadow: var(--toc-shadow-active);
}

.VPDocAsideOutline .outline-link.active::after {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--toc-gradient-active);
    animation: slideIn 0.3s var(--toc-spring);
}

@keyframes slideIn {
    from {
        transform: scaleY(0);
        opacity: 0;
    }
    to {
        transform: scaleY(1);
        opacity: 1;
    }
}

/* Active Section Indicator */
.VPDocAsideOutline .outline-link.active::before {
    opacity: 1;
    background: var(--vp-c-brand-1);
    width: 8px;
    height: 8px;
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% {
        transform: translateY(-50%) scale(1);
        box-shadow: 0 0 0 0 rgba(91, 103, 234, 0.4);
    }
    50% {
        transform: translateY(-50%) scale(1.1);
        box-shadow: 0 0 0 8px rgba(91, 103, 234, 0);
    }
}

/* ========================================================================
   5. Advanced Features
   ======================================================================== */

/* Estimated Reading Time */
.VPDocAsideOutline[data-reading-time]::before {
    content: attr(data-reading-time) ' · On this page';
}

:lang(zh) .VPDocAsideOutline[data-reading-time]::before {
    content: attr(data-reading-time) ' · 本页目录';
}

:lang(ja) .VPDocAsideOutline[data-reading-time]::before {
    content: attr(data-reading-time) ' · このページ';
}

/* Collapsible Sections for Long TOCs */
.VPDocAsideOutline.collapsible .outline-link[data-level="1"] {
    cursor: pointer;
    position: relative;
    padding-right: 2rem;
}

.VPDocAsideOutline.collapsible .outline-link[data-level="1"]::after {
    content: '▼';
    position: absolute;
    right: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.75rem;
    transition: transform 0.3s;
    color: var(--vp-c-text-3);
}

.VPDocAsideOutline.collapsible .outline-link[data-level="1"].collapsed::after {
    transform: translateY(-50%) rotate(-90deg);
}

.VPDocAsideOutline.collapsible .outline-link[data-level="1"].collapsed ~ .outline-link {
    display: none;
}

/* Search Highlight */
.VPDocAsideOutline .outline-link.search-match {
    background: linear-gradient(
            90deg,
            rgba(255, 235, 59, 0.2) 0%,
            transparent 100%
    );
    color: var(--vp-c-brand-1);
}

.VPDocAsideOutline .outline-link.search-match mark {
    background: rgba(255, 235, 59, 0.5);
    color: inherit;
    padding: 0 2px;
    border-radius: 2px;
}

/* Smooth Scroll Indicator */
.VPDocAsideOutline .scroll-progress {
    position: fixed;
    top: var(--vp-nav-height);
    right: 0;
    width: 3px;
    height: 0%;
    background: var(--toc-gradient-primary);
    transition: height 0.1s ease-out;
    z-index: 100;
}

/* ========================================================================
   6. Mobile & Responsive Design
   ======================================================================== */

/* Tablet View */
@media (max-width: 1280px) and (min-width: 768px) {
    .VPDocAsideOutline {
        padding: 1rem;
        font-size: 0.9rem;
    }

    .VPDocAsideOutline .outline-link {
        padding: 0.375rem 0.625rem;
    }
}

/* Mobile Floating TOC */
@media (max-width: 768px) {
    .VPDocAsideOutline {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        top: auto;
        max-height: 60vh;
        width: calc(100vw - 2rem);
        max-width: 320px;
        transform: translateY(calc(100% + 2rem));
        transition: transform 0.3s var(--toc-spring);
        z-index: 999;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
    }

    .VPDocAsideOutline.visible {
        transform: translateY(0);
    }

    /* Mobile TOC Toggle Button */
    .VPDocAsideOutline::before {
        content: '☰ Table of Contents';
        cursor: pointer;
        background: var(--vp-c-brand-1);
        color: white;
        padding: 0.75rem;
        margin: -1.5rem -1.5rem 1rem;
        display: block;
        text-align: center;
        font-size: 0.875rem;
        border-radius: 16px 16px 0 0;
    }

    :lang(zh) .VPDocAsideOutline::before { content: '☰ 目录导航'; }
    :lang(ja) .VPDocAsideOutline::before { content: '☰ 目次'; }
}

/* Touch-friendly interactions */
@media (pointer: coarse) {
    .VPDocAsideOutline .outline-link {
        min-height: 44px;
        display: flex;
        align-items: center;
    }
}

/* ========================================================================
   7. Accessibility & Keyboard Navigation
   ======================================================================== */

/* Focus States */
.VPDocAsideOutline .outline-link:focus-visible {
    outline: 2px solid var(--vp-c-brand-1);
    outline-offset: 2px;
    background: var(--vp-c-brand-soft);
}

/* Keyboard Navigation Indicators */
.VPDocAsideOutline .outline-link[aria-current="true"] {
    font-weight: 600;
    color: var(--vp-c-brand-1);
}

/* Screen Reader Enhancements */
.VPDocAsideOutline .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* High Contrast Mode Support */
@media (prefers-contrast: high) {
    .VPDocAsideOutline {
        border-width: 2px;
    }

    .VPDocAsideOutline .outline-link.active {
        outline: 2px solid currentColor;
    }
}

/* ========================================================================
   8. CJK Language Optimizations
   ======================================================================== */

/* Better spacing for Chinese/Japanese/Korean text */
:lang(zh) .VPDocAsideOutline .outline-link,
:lang(ja) .VPDocAsideOutline .outline-link,
:lang(zh-hk) .VPDocAsideOutline .outline-link,
:lang(zh-tw) .VPDocAsideOutline .outline-link,
:lang(ko) .VPDocAsideOutline .outline-link {
    letter-spacing: 0.02em;
    line-height: 1.6;
}

/* Adjusted font weights for better CJK readability */
:lang(zh) .VPDocAsideOutline .outline-link.active,
:lang(ja) .VPDocAsideOutline .outline-link.active,
:lang(zh-hk) .VPDocAsideOutline .outline-link.active,
:lang(zh-tw) .VPDocAsideOutline .outline-link.active,
:lang(ko) .VPDocAsideOutline .outline-link.active {
    font-weight: 700;
}

/* ========================================================================
   9. Performance Optimizations
   ======================================================================== */

/* GPU Acceleration for Smooth Animations */
.VPDocAsideOutline .outline-link {
    will-change: transform, background-color;
    transform: translateZ(0);
}

/* Reduce animations for performance-sensitive environments */
@media (prefers-reduced-motion: reduce) {
    .VPDocAsideOutline,
    .VPDocAsideOutline .outline-link {
        transition-duration: 0.01ms !important;
        animation-duration: 0.01ms !important;
    }
}

/* ========================================================================
   10. Dark Theme Enhancements
   ======================================================================== */

.dark .VPDocAsideOutline {
    background: rgba(30, 30, 34, 0.6);
    backdrop-filter: blur(10px);
    border-color: rgba(255, 255, 255, 0.1);
}

.dark .VPDocAsideOutline .outline-link {
    color: var(--vp-c-text-2);
}

.dark .VPDocAsideOutline .outline-link:hover {
    background: rgba(91, 103, 234, 0.1);
    color: var(--vp-c-brand-lighter);
}

.dark .VPDocAsideOutline .outline-link.active {
    background: linear-gradient(
            90deg,
            rgba(91, 103, 234, 0.2) 0%,
            transparent 100%
    );
    color: var(--vp-c-brand-lighter);
}

/* ========================================================================
   11. Print Styles
   ======================================================================== */

@media print {
    .VPDocAsideOutline {
        display: none;
    }
}

/* ========================================================================
   12. Custom Animations & Effects
   ======================================================================== */

/* Entrance Animation */
.VPDocAsideOutline {
    animation: tocSlideIn 0.5s ease-out;
}

@keyframes tocSlideIn {
    from {
        opacity: 0;
        transform: translateX(20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* Smooth Height Transitions for Collapsible Sections */
.VPDocAsideOutline .outline-group {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.VPDocAsideOutline .outline-group.collapsed {
    max-height: 0;
}

/* Floating Label Effect */
.VPDocAsideOutline .section-label {
    position: absolute;
    right: 0.5rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.65rem;
    padding: 0.125rem 0.375rem;
    background: var(--vp-c-brand-soft);
    color: var(--vp-c-brand-1);
    border-radius: 4px;
    opacity: 0;
    transition: opacity 0.2s;
}

.VPDocAsideOutline .outline-link:hover .section-label {
    opacity: 1;
}

/* ========================================================================
   13. Integration with VitePress Default Styles
   ======================================================================== */

/* Override default VitePress TOC styles */
.VPDocAside .VPDocAsideOutline .outline-title {
    display: none; /* We use custom header */
}

.VPDocAside .VPDocAsideOutline .outline-link {
    display: block !important; /* Ensure our styles take precedence */
}

/* Ensure compatibility with VitePress theme */
.VPDoc:has(.VPDocAsideOutline) {
    scroll-behavior: smooth;
}

/* Smooth scroll offset for fixed header */
.VPDoc [id] {
    scroll-margin-top: calc(var(--vp-nav-height) + 2rem);
}